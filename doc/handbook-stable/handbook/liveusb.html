<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr">
<head>
    <title>SliTaz Handbook - LiveUSB</title>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1" />
    <meta name="description" content="" />
    <meta name="expires" content="never" />
    <meta name="modified" content="2007-12-04 12:30:00" />
    <meta name="publisher" content="www.slitaz.org" />
    <meta name="author" content="Christophe Lincoln"/>
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" type="text/css" href="book.css" />
</head>
<body bgcolor="#ffffff">

<!-- Header and quick navigation -->
<div id="header">
<div align="right" id="quicknav">
    <a name="top"></a>
    <a href="index.html">Table des matières</a>
</div>
<h1><font color="#3E1220">SliTaz Handbook</font></h1>
</div>

<!-- Content. -->
<div id="content">
<div class="content-right"></div>

<h2><font color="#DF8F06">LiveUSB - SliTaz sur un media USB</font></h2>

<ul>
	<li><a href="#method">Methodes, type de media et notes</a> - Introduction,
	système de fichiers, résumé des étapes.</li>
	<li><a href="#tazusb">LiveUSB en 2 commandes</a> - Utiliser TazUSB pour
	créer un LiveUSB facilement.</li>
	<li><a href="#prepa">Préparer le media USB</a> - Formater si besoin est,
	copier les fichiers du LiveCD.</li>
	<li><a href="#grub">Installer et utiliser GRUB</a> - Installer le
	gestionnaire de démarrage GRUB sur le media USB.</li>
	<li><a href="#grubiso">GRUB sur cdrom</a> - Utiliser le media via un cdrom
	bootable contenant GRUB.</li>
	<li><a href="#extlinux">Installer et utiliser EXTLINUX</a> - Installer le
	gestionnaire de démarrage EXTLINUX sur le media USB.</li>
	<li><a href="#windows">Installer SliTaz sur USB depuis Windows</a> - Installer
	SliTaz sur un media USB en utilisanr Syslinux depuis Windows.</li>
</ul>

<a name="method"></a>
<h3><font color="#6c0023">Methodes, type de media et notes</font></h3>
<p>
Ce document décrit les étapes à réaliser pour installer les fichiers nécessaires
afin de démarrer SliTaz depuis un périphérique de type USB (clé, carte SD,
disque dur externe). Ce n'est pas une installation du système à proprement
parler, le mode de fonctionnemnt de SliTaz reste le même qu'en mode LiveCD,
c'est à dire que le système sera entièrement chargé en mémoire vive (RAM)
lors du démarrage. Avoir SliTaz sur un media USB vous permet de vous passer
du cdrom sur les machines capables de démarrer depuis un périphérique USB et
l'utiliser le même media pour stocker vos données personnelles de manière
persistante. Il faut aussi savoir que tous les PC ne sont pas capables de 
démarrer directement sur USB et que le démarrage du système est plus long
que depuis un cdrom.
</p>
<h4>Disque dur externe, carte SD ou clé USB</h4>
<p>
Un media de stockage USB peut être un disque dur externe de grande ou petite
capacité, une carte de type SD/flash ou une clé USB. Vous pouvez par exemple,
utiliser l'ancienne carte d'un appareil de photos numérique ayant au 
minimum une capacité de 32 Mb. Cela dit, l'utilisation de 
<a href="#grub">GRUB</a> avec les clés USB ne réussi pas toujours et dépend
du type de clé. Si l'utilisation de GRUB échoue, il est conseillé d'utiliser
le gestionaire de démarrage <a href="#extlinux">EXTLINUX</a> et d'installer
un MBR fonctionnel sur la clé USB.
</p>
<p>
Pour commencer nous vous conseillons d'utiliser une partition formatée en ext3
et non au format natif FAT32. Le système de fichiers ext3 est un système de
fichiers propre à GNU/Linux, robuste, fiable et illisible nativement depuis
Windows, ce qui peut être un point positif ou négatif. A noter que vous pourrez
aussi utiliser cette même partition pour stocker vos données de manière
persistante via l'option <code>home=usb</code> proposée par SliTaz. Cela dit,
vous pouvez aussi installer SliTaz sur une clé USB au format FAT32 comme
suggéré sur le forum de SliTaz : 
<a href="http://forum.slitaz.org/viewtopic.php?pid=28#p28">SliTaz sur clé USB FAT32</a>.
</p>
<h4>&Eacute;tapes à réaliser</h4>
<p>
En gros, il faut récupérer les fichiers contenus sur le LiveCD, les
copier sur le media USB et installer un gestionnaire de démarrage. A noter
qu'il existe plusieurs gestionnaires de démarrage, Syslinux, GRUB ou encore
Lilo. SliTaz fournit GRUB sur la version standard du LiveCD et dans les paquets
du miroir, il a l'avantage de pouvoir aussi être utilisé pour démarrer
d'autres systèmes d'expoitations et de proposer un SHell permettant par exemple
de réinstaller GRUB dans le MBR (Master Boot Record) d'un disque dur.
</p>

<a name="tazusb"></a>
<h3><font color="#6c0023">LiveUSB en 2 commandes</font></h3>
<p>
Pour créer facilement un système Live tenant sur un media USB, vous pouvez
utiliser TazUSB ou installer les fichiers manuellement. TazUSB est un 
utilitaire simple, efficace et bien testé. Vous pouvez créer un media en une ou
deux commandes. Pour cela il vous faut un LiveCD de SliTaz et biensûr un media
USB dont vous devez connaître le nom (<code>fdisk -l</code> ou <code>blkid</code>).
Formatage optionnel et génération d'un media bootable reconnu comme /dev/sdb1:
</p>
<pre>
 # tazusb format /dev/sdb1
 # tazusb gen-liveusb /dev/sdb1
</pre>
<p>
Une fois le media généré, vous pouvez redémarrer sur votre media USB. Si vous 
désirez installer des applications, mettre à jour ou configurer le système et
retouver vos modifications lors de a prochaine utilisation, il vous faut
recréer le système compressé en utilisant la commande <code>writefs</code> de
TazUSB. A noter que le menu de JWM propose par défaut des entrées pour écrire
le système sur le media en utilisant gzip, lzma ou aucune compression (prend 
plus de place mais démarre beaucoup plus rapidement).
</p>

<a name="prepa"></a>
<h3><font color="#6c0023">Préparer le media USB</font></h3>
<p>
Si vous avez déjà une partition au format ext3, vous n'avez pas besoin de
reformater, sinon il faut créer un système de fichier avec l'utilitaire
<code>mkfs.ext3</code>. Attention le formatage d'une partition détruit toutes
les données qui s'y trouvent. Généralement, la première ou unique partition 
d'un media USB est reconnu par le noyau Linux comme <code>/dev/sda</code>, pour
lister les périphériques et partitions disponibles vous pouvez utiliser la
commande <code>fdisk -l</code> avant de créer le système de fichiers ext3 :
</p>
<pre>
 # mkfs.ext3 /dev/sda1
 # mount -t ext3 /dev/sda1 /media/flash
</pre>
<p>
Le formatage de la partition va créer un répertoire système nommé
<code>lost+found</code> (perdu et trouvé), ce répertoire est utiliser par le
système de fichier en cas de problèmes. Maintenant que le media est formaté 
et monté, vous pouvez copier le contenu du cdrom sur le périphérique, soit
depuis un cdrom gravé, soit depuis une image ISO locale :
</p>
<pre>
 # mount -t iso9660 /dev/cdrom /media/cdrom
 Ou :
 # mount -o loop slitaz-cooking.iso /media/cdrom
</pre>
<p>
Copie de tous les fichiers contenu dans le répertoire <code>boot/</code>
du LiveCD, il se peut que le système de fichiers compressé soit nommé 
<code>rootfs.lz</code>, si c'est le cas, il faut le renommer en 
<code>rootfs.gz</code> :
</p>
<pre>
 # cp -a /media/cdrom/boot /media/flash
 # mv /media/flash/boot/rootfs.lz /media/flash/boot/rootfs.gz
</pre>

<a name="grub"></a>
<h3><font color="#6c0023">Installer et utiliser GRUB</font></h3>
<p>
Pour installer GRUB (GRand Unified Bootloader) il faut commencer par copier 
les fichiers <code>stage1</code> et <code>stage2</code> depuis 
<code>/usr/lib/grub/i386-pc</code> dans le répertoire <code>boot/grub</code> 
du media USB. Une fois les fichiers copiés et le media trouvé par GRUB, vous
allez pouvoir installer le gestionnaire de démarrage dans le MBR du
périphérique. Copie des fichiers, lancement du SHell GRUB et recherche de
<code>stage1</code> fraîchement copié :
</p>
<pre>
 # cp /usr/lib/grub/i386-pc/stage[1-2] /media/flash/boot/grub
 # grub
 grub> find /boot/grub/stage1
</pre>
<p>
Ce qui peut donner (hd0,0), (hd1,0) ou encore (hd2,0), GRUB voit le premier
disque <code>hda</code> comme <code>hd0</code>, il faut donc modifier les 
valeures en fonction de votre configuration. Il se peut aussi que votre media 
ne soit pas trouvé, dans ce cas vous pouvez utiliser le <em>bootloader</em>
<a href="#extlinux">EXTLINUX</a>. Pour installer GRUB vous pouvez
utiliser les commandes <code>root</code> et <code>setup</code>. Pour quitter 
le SHell GRUB c'est la commande <code>quit</code> :
</p>
<pre>
 grub> root (hd2,0)
 grub> setup (hd2)
 grub> quit
</pre>
<p>
La dernière chose qu'il reste à faire avant de redémarrer, est de créer un
fichier de configuration de GRUB permettant de lancer SliTaz avec l'option
<code>home=usb</code>, ce qui permet d'utiliser aussi le media comme partition
<code>/home</code> pour stocker ses données, installer des applications en 
espace utilisateur et conserver vos configurations logiciels. Le fichiers
de configuration utilisé par GRUB peut être créé avec votre éditeur de texte
préféré, exemple avec LeafPad :
</p>
<pre>
 # leafpad /media/flash/boot/grub/menu.lst
</pre>
<pre class="script">
# /boot/grub/menu.lst: GRUB boot loader configuration.
#

# Change the colors.
color yellow/brown light-green/black

# For booting SliTaz from a cdrom or USB media (LiveRAM).
#
title 	SliTaz GNU/Linux (Cooking) (Kernel 2.6.22.9)
kernel 	/boot/bzImage root=/dev/null vga=771 home=usb
initrd 	/boot/rootfs.gz
</pre>
<p>
Vous pouvez encore ajouter ces quelques lignes, pour avoir une entrée
permettant de réinstaller GRUB dans un MBR (utile en cas problèmes) :
</p>
<pre class="script">
# For installing GRUB into the hard disk
#
title Install GRUB into the hard disk
root 	(hd0,0)
setup 	(hd0)
</pre>
<p>
Voilà, vous pouvez démonter le cdrom et le media. ET redémarrer sur votre
clé USB en prenant soins de configurer correctement le BIOS de votre machine
pour qu'elle démarre depuis le media USB et non depuis le disque dur :
</p>
<pre>
 # umount /media/cdrom
 # umount /media/flash
 # reboot
</pre>

<a name="grubiso"></a>
<h3><font color="#6c0023">GRUB sur cdrom</font></h3>
<p>
Il est possible de créer rapidement une image ISO contenant GRUB, servant à 
démarrer SliTaz depuis un media USB et cela sur des machines ne pouvant pas
démarrer directement sur USB. Pour ce faire GRUB fourni une image nommée
<code>stage2_eltorito</code> permettant de rendre un cdrom bootable. Pour créer
une image ISO gravable il faut créer la racine du cdrom, copier le fichier
<code>stage2_eltorito</code> et générer une ISO avec <code>genisoimage</code>.
Les commandes peuvent être copiées/collées ligne par ligne. Pour créer la
racine du cdrom (<code>rootcd</code> et copier l'image eltorito de GRUB :
</p>
<pre>
 $ mkdir -p rootcd/boot/grub
 $ cp /usr/lib/grub/i386-pc/stage2_eltorito \
   rootcd/boot/grub
</pre>
<p>
Le fichier de configuration de grub se nomme toujours <code>menu.lst</code>,
c'est un fichier texte éditable avec votre éditeur de texte préféré. Vous
pouvez mettre le nombre d'entrées que vous désirez, pour démarrer SliTaz il
faut spécifier la bonne racine <code>root (hd2,0)</code> pour que GRUB trouve
le noyau (<code>bzImage</code>) et le système compressé (<code>roottf.gz</code>).
Un petit fichier de configuration minimaliste :
</p>
<pre class="script">
# /boot/grub/menu.lst: GRUB boot loader configuration.
#

title 	SliTaz GNU/Linux (Cooking)
root 	(hd2,0)
kernel 	/boot/bzImage root=/dev/null home=usb
initrd 	/boot/rootfs.gz
</pre>
<h4>Générer un ISO bootable</h4>
<p>
Pour générer une image ISO vous pouvez utiliser <code>genisoimage</code>
fourni en standard sur le LiveCD de SliTaz. Cette commande est relativement 
longue, les <em>backslash</em> en fin de ligne permettent de continuer la 
commande sur la ligne suivante. Dans l'exemple, l'image se nomme
<code>grub.iso</code>, le volume Grub et la racine du cdrom 
<code>rootcd</code> :
</p>
<pre>
 $ genisoimage -R -o grub.iso \
       -b boot/grub/stage2_eltorito \
       -no-emul-boot -V "Grub" -boot-load-size 4 \
       -input-charset iso8859-1 -boot-info-table \
       rootcd
</pre>

<a name="extlinux"></a>
<h3><font color="#6c0023">Installer et utiliser EXTLINUX</font></h3>
<p>
Extlinux est un gestionnaire de démarrage provenant du paquet Syslinux, il 
permet de démarrer un système GNU/Linux depuis un système de fichiers ext2 ou 
ext3. C'est un gestionnaire de démarrage simple et fiable, il fonctionne bien
pour les clés USB. Pour commencer il faut récupérer la dernière version
du paquet Syslinux depuis le site du noyau Linux et installer le binaire 
<code>extlinux</code> dans votre répertoire personnel <code>~/Bin</code> ou
dans un répertoire système tel que <code>/usr/bin</code>. Pour télécharger,
désarchiver et installer EXTLINUX en espace utilisateur :
</p>
<pre>
 $ wget http://www.kernel.org/pub/linux/utils/boot/syslinux/syslinux-3.61.tar.gz
 $ tar xzf syslinux-3.61.tar.gz
 $ cp syslinux-3.61/extlinux/extlinux ~/.local/bin
</pre>
<p>
Maintenant que le binaire <code>extlinux</code> est disponible, vous pouvez
l'installer dans sur un media monté et cela via un SHell administrateur 
<em>root</em> obtenu via la commande <code>su</code>. Nous vous conseillons
d'installer EXTLINUX dans un répertoire dédié, c'est à dire 
<code>/boot/extlinux</code> du media USB :
</p>
<pre>
 # mkdir -p /media/flash/boot/extlinux
 # extlinux --install /media/flash/boot/extlinux
</pre>
<p>
Sur les clé USB il faut encore installer un MBR pour s'assurer de rendre le 
media bootable. Attention à spécifier le bon périphérique, dans la plus part 
des cas une clé USB est reconnue comme sda :
</p>
<pre>
 # cat syslinux-3.61/mbr/mbr.bin > /dev/sda
</pre>
<p>
Le fichier de configuration se nomme <code>extlinux.conf</code> et doit se
trouver dans le même répertoire que le binaire <code>extlinux</code>. Les 
chemins vers les fichiers peuvent être absolus ou relatifs au répertoire 
d'installation d'extlinux. Ce fichier à la même syntaxe que le fichier
<code>isolinux.cfg</code> utilisé pour démarrer le LiveCD de SliTaz. Vous
utilisant votre éditeur de texte préféré ou la commande <code>cat</code> 
(<code>EOT</code> signifie <em>End Of Text</em>, c'est là que le fichier
se termine). A noter que vous pouvez copier/coller le contenu du fichier en
une seule fois :
</p>
<pre>
 # cat &gt; /media/flash/boot/extlinux/extlinux.conf &lt;&lt; "EOT"
</pre>
<pre class="script">
display display.txt
default slitaz
label slitaz
    kernel /boot/bzImage
    append initrd=/boot/rootfs.gz rw root=/dev/null home=usb
</pre>
<pre>
 EOT
</pre>
<h4>Afficher un message boot</h4>
<p>
La première ligne <code>display display.txt</code> permet d'afficher un fichier
text au démarrage de EXTLINUX, vous pouvez utiliser/modifier celui utiliser sur
le LiveCD ou en créer un nouveau. Si vous ne voulez pas afficher un 
<em>display</em>, il suffit de supprimer la ligne. Pour créer un nouveau
fichier <code>display.txt</code> avec <code>cat </code>:
</p>
<pre>
 # cat &gt; /media/flash/boot/extlinux/display.txt &lt;&lt; "EOT"
</pre>
<pre class="script">
/*       _\|/_
         (o o)
 +----oOO-{_}-OOo---------------------------------------------------+
     ____  _ _ _____
    / ___|| (_)_   _|_ _ ____
    \___ \| | | | |/ _` |_  /
     ___) | | | | | (_| |/ /
    |____/|_|_| |_|\__,_/___|

 SliTaz GNU/Linux LiveUSB

 Simple Light Incredible Temporary Autonomus Zone

                                                                   */
</pre>
<pre>
 EOT
</pre>
<p>
Reste plus qu'a redémarrer sur votre clé USB en prenant soins de configurer 
correctement le BIOS de votre machine pour qu'elle démarre depuis le media USB
et non depuis le disque dur :
</p>
<pre>
 # umount /media/flash
 # reboot
</pre>

<a name="windows"></a>
<h3><font color="#6c0023">Installer SliTaz sur USB depuis Windows</font></h3>
<p>
Il est possible d'installer SliTaz sur un media USB depuis un système 
Windows, cette procédure a été testé sur Windows XP et Vista. Avant de 
commercer, téléchargez la dernière version de SliTaz sur le site : 
<a href="http://www.slitaz.org/get/">Obtenir SliTaz</a>. Il vous faut aussi 
récupérer l'utilitaire syslnux <a 
	href="http://www.eu.kernel.org/pub/linux/boot/syslinux/syslinux-3.60.zip"
	>syslinux-3.60.zip</a>.
</p>
<p>
1. Extraire l'image sur la clé USB. L'image ISO peut être extraite avec des 
outils comme <a href="http://www.7-zip.org">7-Zip</a> ou Winimage (shareware)
par exemple. Normallement vous devriez obtenir l'arborescence suivante :
</p>
<pre class="script">
\boot
\boot\isolinux
\boot\grub
\boot\syslinux
</pre>
<p>
2. Sur la clé USB, copier les fichiers du gestionnaire de démarrage dans le 
répertoire <code>\boot\syslinux</code> :
</p>
<pre class="script">
\boot\isolinux\*.txt 
\boot\isolinux\*.msg
\boot\isolinux\*.cfg
\boot\isolinux\*.lss
</pre>
<p>
3. Toujours dans le répertoire <code>\boot\syslinux</code>, renommer 
<code>isolinux.cfg</code> en <code>syslinux.cfg</code> et 
<code>isolinux.msg</code> en <code>syslinux.msg</code>. Ce n'est pas 
indipensable pour isolinux.msg, mais c'est plus cohérent.
</p>
<p>
4. Extraire le fichier syslinux.exe de l'archive téléchargée sur kernel.org et 
le copier dans <code>\boot\syslinux</code> sur la clé.
</p>
<p>
5. Modifiez le fichier <code>syslinux.cfg</code> pour qu'il corresponde à vos 
besoin. Exemple:
</p>
<pre class="script">
display syslinux.msg
default slitaz
label slitaz
	kernel /boot/bzImage
	append initrd=/boot/rootfs.gz rw root=/dev/null lang=fr kmap=fr vga=normal
implicit 0	
prompt 1	
timeout 80
F1 help.txt
F2 options.txt
F3 isolinux.msg
F4 display.txt
</pre>
<p>
<strong>Note :</strong> Par rapport au fichier d'origine la ligne 
<code>display isolinux.msg</code> a été remplaçée par 
<code>display syslinux.cfg</code>. Et les paramètres 
<code>lang=fr kmap=fr</code> on été rajouté sur la ligne <code>append</code>.
</p>
<p>
6. Il ne reste plus qu'à exécuter <code>syslinux.exe</code> pour installer le 
<em>bootloader</em>. Exemple dans le cas où la clé est désignée par la lettre
K :
</p>
<pre>
K:
cd \boot\syslinux
syslinux -ma -d \boot\syslinux K:
</pre>

<h4>Version rapide</h4>
<ol>
	<li>Télécharchez l'achive <a 
	href="http://files.openomy.com/public/Erjo/syslinux.zip">syslnux.zip</a>.</li>
	<li>Extrayez le répertoire syslinux et copiez le dans le répertoire 
	boot de la clé USB.</li>
	<li>Exécutez le script <code>\boot\syslinux\bootusb.bat</code>.</li>
</ol>

<!-- End of content -->
</div>

<!-- Footer. -->
<div id="footer">
	<div class="footer-right"></div>
	<a href="#top">Haut de la page</a> | 
	<a href="index.html">Table des matières</a>
</div>

<div id="copy">
    Copyright © 2007 <a href="http://www.slitaz.org/">SliTaz</a> -
    <a href="http://www.gnu.org/licenses/gpl.html">GNU General Public License</a>;<br />
    Documentation publiées sous
    <a href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License</a>
    et codée en <a href="http://validator.w3.org/">xHTML 1.0 valide</a>.
</div>

</body>
</html>
