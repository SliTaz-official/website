<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr">
<head>
    <title>SliTaz Handbook - Network config</title>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1" />
    <meta name="description" content="DHCP ifconfig réseau sur SliTaz udhcpc masque passerelle 127.0.0.1 hostname IP fixe PPPOE" />
    <meta name="expires" content="never" />
    <meta name="modified" content="2007-12-04 12:30:00" />
    <meta name="publisher" content="www.slitaz.org" />
    <meta name="author" content="Christophe Lincoln"/>
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" type="text/css" href="book.css" />
</head>
<body bgcolor="#ffffff">

<!-- Header and quick navigation -->
<div id="header">
<div align="right" id="quicknav">
    <a name="top"></a>
    <a href="web-server.html">Serveur web</a> |
    <a href="index.html">Table des matières</a>
</div>
<h1><font color="#3E1220">SliTaz Handbook</font></h1>
</div>

<!-- Content. -->
<div id="content">
<div class="content-right"></div>

<h2><font color="#DF8F06">Configuration du réseau</font></h2>

<ul>
	<li><a href="#about">A propos du réseau sur SliTaz.</a></li>
	<li><a href="#netbox">Netbox</a> - Configuration graphique du réseau.</li>
	<li><a href="#wifibox">Wifibox</a> - Configuration graphique du réseau sans fil.</li>
	<li><a href="#hostname">/etc/hostname</a> - Le nom de machine.</li>
 	<li><a href="#network.conf">/etc/network.conf</a> -  Fichier de
	configuration du réseau.</li>
	<li><a href="#dynamicIP">IP dynamique</a> - Client DHCP udhcpc.</li>
	<li><a href="#staticIP">IP static</a> - Utilisation d'un adresse fixe.</li>
	<li><a href="#pppoe">Connexion ADSL en pppoe kernel-mode.</a></li>
	<li><a href="#rp-pppoe">Connexion ADSL avec rp-pppoe.</a></li>
	<li><a href="#list">Liste des interfaces et des routes.</a></li>
	<li><a href="#firewall">Gestion du pare-feu</a> - (<em>firewall</em>).</li>
	<li><a href="web-server.html">Configuration du serveur web.</a></li>
	<li><a href="secure-shell.html">Gestion du serveur SSH.</a></li>
</ul>

<a name="about"></a>
<h3><font color="#6c0023">A propos du réseau sur SliTaz</font></h3>
<p>
Par défaut SliTaz lance le client DHCP (udhcpc) sur eth0 lors du boot. Si
votre carte réseau a bien été reconnue comme une interface eth0, et que vous
utilisez un routeur, votre connexion devrait déjà fonctionner. C'est une
configuration dynamique, à chaque démarrage du système le client DHCP obtient
une nouvelle adresse IP depuis le serveur DHCP, qui est intégré au
router, ou situé sur une autre machine. Pour changer la configuration par
défaut vous devez passer par le fichier /etc/network.conf décrit ci-dessous.
Pour les personnes utilisant <a href="#pppoe">PPPOE</a>, vous pouvez utiliser
les outils fournis par <code>rp-pppoe</code> et installés par défaut sur SliTaz.
</p>

<a name="netbox"></a>
<h3><font color="#6c0023">Netbox - Configuration graphique du réseau</font></h3>
<p>
Netbox est un petite interface graphique permettant de facilement configurer
une interface réseau Ethernet en utilisant le protocole DHCP ou en demandant
une adresse IP fixe. Les onglets <em>DHCP</em> et <em>Staic IP</em> permettent
de démarrer ou stopper la connexion et change automatiquement les valeurs 
dans les fichiers système. Les connexions Ethernet sont des connection 
cablées (RJ45) et ne nécessite pas d'authentification. Netbox fournit 
aussi un onglet <em>System wide</em> depuis lequel vous pouvez directement
éditer les fichiers de configuration système. Les connections PPPoE ou 
PPP demandant un nom d'utilisateur et un mot de passe on leur propre onglet.
L'outils permet encore de configurer différents serveurs: SSH, Inetd,
ZeroConf, DHCP, PXE, DSN, Rsync, HTTP. Il aussi possible de créer un 
réseau privé virtuel ou VPN avec les outils inclus de base dans la 
distribution.
</p>

<img
	src="images/screenshots/netbox.png"
	style="width: 536px; height: 357px;" />

<p>
Vous pouvez lancer Netbox depuis le menu "Outils système" (<em>System tools</em>)
&rarr; "Netbox Configurer le réseau" ou depuis un terminal graphique. C'est un
outil qui permet de modifier des configuration système, il faut donc être
administrateur (<em>root</em>) pour l'utiliser :
</p>
<pre>
 $ subox netbox
</pre>

<a name="wifibox"></a>
<h3><font color="#6c0023">Wifibox - Configuration graphique du réseau sans fil</font></h3>
<p>
Wifibox est une petite interface permettant de configurer une connexion
à un réseau sans file (Wifi, Wireless ou Wlan). L'onglet 'Netwoks' affiche
la liste des réseaux disponibles, il suffit de double cliquer sur un nom
de réseau pour établir la connexion, si le réseau est sécurisé, la clé
vous sera alors demandée.
</p>

<img
	src="images/screenshots/wifibox.png"
	style="width: 533px; height: 330px;" />

<p>
L'onglet 'Favorites' permet de préconfigurer ses réseaux préférés, une
fois un réseau ajouté il suffit de double cliquer sur le nom du réseau
pour établir la connexion. L'onglet 'Configuration' permet de configurer
une connexion manuellement avec les paramètres avançés tels que le mode
ou le canal. L'onglet 'Drivers' permet de configurer une carte réseau,
il y a 3 cas de figure: , 
</p>
<ol>
	<li>La carte est directement supportée par le noyau via un module.</li>
	<li>La cartre à besoin d'un module et d'un firmware non-libre pouvant
	être installé automatiquement via l'outil de détection du matériel.</li>
	<li>La carte n'est pas supportée par Linux et le driver Windows doit
	être installé via le gestionnaire de pilotes Windows (tazndis).</li>
</ol>

<a name="hostname"></a>
<h3><font color="#6c0023">/etc/hostname - Le nom de machine</font></h3>
<p>
Le fichier /etc/hostname configure le nom de la machine. Le nom de machine est
chargé au démarrage du système avec la commande 'hostname'. Sans argument
cette commande retournera le nom de machine actuel :
</p>
<pre>
 $ hostame
</pre>
<p>
Pour changer le nom de machine vous pouvez utiliser la commande 
<code>echo</code> ou utiliser un des éditeurs de texte disponible sur SliTaz 
(il faut être <em>root</em>). Exemple avec <code>echo</code> et le nom 
de machine <code>kayam</code> :
</p>
<pre>
 # echo "kayam" > /etc/hostname
</pre>

<a name="network.conf"></a>
<h3><font color="#6c0023">/etc/network.conf</font></h3>
<p>
Le fichier /etc/network.conf est le fichier de configuration du réseau sur
votre système SliTaz. Sa syntaxe est simple, vous pouvez modifier son contenu
avec un éditeur de texte tel que Nano. Le fichier /etc/network.conf est
utilisé par le script /etc/init.d/network.sh pour configurer les interfaces
réseau au démarrage du système.
</p>
<p>
Le fichier de configuration du réseau (network.conf) vous permet de lancer ou
non le client DHCP au boot. Vous pouvez aussi spécifier une adresse IP fixe
avec son masque de sous réseau, la passerelle par défaut, et le serveur DNS à
utiliser.
</p>

<a name="dynamicIP"></a>
<h3><font color="#6c0023">IP dynamique - Client DHCP udhcpc</font></h3>
<p>
Le client DHCP udhcpc fourni avec Busybox utilise le script
/usr/share/udhcpc/default.script pour obtenir une adresse IP dynamiquement
au boot. Il supporte diverses options que vous pouvez connaître avec l'option
<code>--help</code> :
</p>
<pre>
 # udhcpc --help
</pre>
<p>
Pour ne pas lancer udhcpc sur eth0, ou modifier l'interface (ex: eth1) vous
devez passer par le fichier /etc/network.conf, et spécifier "no" à
la variable DHCP= :
</p>
<pre class="script">

# Dynamic IP address.
# Enable/disable DHCP client at boot time.
DHCP="no"

</pre>

<a name="staticIP"></a>
<h3><font color="#6c0023">IP fixe - Utilisation d'un adresse spécifique</font></h3>
<p>
Vous pouvez spécifier une adresse IP fixe à configurer au démarrage du système,
en mettant la valeur "yes" à la variable STATIC= :
</p>
<pre class="script">

# Static IP address.
# Enable/disable static IP at boot time.
STATIC="yes"

</pre>
<p>
Pour que la configuration fonctionne, vous devez spécifier une adresse IP,
son masque de sous réseau, la passerelle par défaut (gateway), et le serveur
DNS à utiliser. Exemple :
</p>
<pre class="script">

# Set IP address, and netmask for a static IP.
IP="192.168.0.6"
NETMASK="255.255.255.0"

# Set route gateway for a static IP.
GATEWAY="192.168.0.1"

# Set DNS server. for a static IP.
DNS_SERVER="192.168.0.1"

</pre>

<a name="pppoe"></a>
<h3><font color="#6c0023">Connexion internet ADSL en pppoe kernel-mode</font></h3>
<p>
Pré-requis: le support ppp et pppoe doit être activé dans le noyau (dur ou 
modules) et l'interface ethernet configurée. Vous devez indiquer à ppp 
d'utiliser le plugin rp-pppoe du noyau dans <code>/etc/ppp/options</code> :
</p>
<pre class="script">
plugin rp-pppoe.so
name &lt;votre identifiant de connexion FAI&gt;
noipdefault
defaultroute
mtu 1492
mru 1492
lock
</pre>
<p>
Si vous avez compilé le support de votre carte réseau en module dans le noyau,
vous devrez activer ce dernier dans /etc/rcS.conf:
</p>
<pre class="script">
LOAD_MODULES="&lt;votre module&gt;"
</pre>
<p>
Modifier le fichier /etc/ppp/pap-secrets ou /etc/ppp/chap-secrets :
</p>
<pre class="script">
# client	       server	       secret			IP addresses
"votre_login_fai"       *       "mot_de_passe"
</pre>
<p>
Les fichiers /etc/host.conf et /etc/resolv.conf devraient être automatiquement renseignés.
C'est tout ! Pour vous connecter à internet, il suffit simplement de taper :
</p>
<pre>
pppd eth0
</pre>

<a name="rp-pppoe"></a>
<h3><font color="#6c0023">Connexion pppoe avec rp-pppoe</font></h3>
<p>
Pour configurer sa connexion internet ADSL via le protocole PPPOE, SliTaz
fournit la suite d'utilitaires du paquet <code>rp-pppoe</code>. L'utilisation
de <code>pppoe-setup</code> est un jeu d'enfant et vous permet de configurer
rapidement le réseau. Si vous utilisez DHCP c'est encore plus facile, puisque
c'est le serveur de votre FAI (Fournisseur d'accès internet) qui va s'occuper
de tout. Si vous n'avez pas le DHCP vous devez commencer par désactiver son
utilisation via la variable <code>DHCP="no"</code> du fichier de configuration
<code>/etc/network.conf</code>. A noter que pour modifier des fichiers de
configuration système et se connecter, vous devez devenir administrateur via
la commande <code>su</code>. Pour installer rp-pppoe et changer la variable 
DHCP avec Nano (Ctrl + x pour sauver et quitter) :
</p>
<pre>
 $ su
 # tazpkg get-install rp-pppoe
 # nano /etc/network.conf
</pre>
<h4>Configurer avec pppoe-setup</h4>
<p>
Pour commencer à configurer votre connexion PPPOE, vous devez ouvrir un
terminal X ou utiliser la console Linux pour lancer <code>pppoe-setup</code>
et répondre aux questions :
</p>
<pre>
 # pppoe-setup
</pre>
<ol>
	<li>Tapez votre nom d'utilisateur. A noter qu'il s'agit du nom
	d'utilisateur avec lequel vous communiquez avec votre FAI, ils est
	différent de ceux du système, bien sûr.</li>
	<li>Interface internet, il s'agit par défaut de eth0 sauf si vous en avez
	plusieurs, auquel cas vous aurez eth1, eth2, etc.. généralement la touche
	<strong>entree</strong> suffit.</li>
	<li>Si vous avez un lien ADSL permanent répondez ici par
	<strong>oui</strong>, sinon par <strong>non</strong> (valeur par
	défaut).</li>
	<li>Spécifiez les DNS primaire et secondaire de votre FAI, il vous
	les communiquera, n'hésitez pas à les lui demander.</li>
	<li>Tapez le mot de passe avec lequel vous communiquez avec votre FAI,
	à noter que vous devrez le tapez deux fois.</li>
	<li>Choisir le firewall ou pare-feu en fonction de votre matériel,
	si vous avez un routeur vous pouvez entrer 2 sinon 1. En cas de doute
	tapez 1.</li>
</ol>
<h4>Démarrer et arrêter la connexion</h4>
<p>
Toujours en ligne de commande, il suffit de lancer <code>pppoe-start</code>
pour démarrer la connexion. Quelques secondes puis le système vous dit qu'il
est connecté. S'il vous donne un message du genre TIMED OUT c'est que vous
avez mal configuré ou que les branchements sont défectueux. Revérifiez votre
cablage et reprenez l'installation au début. Pour démarrer sa connexion :
</p>
<pre>
 # pppoe-start
</pre>
<p>
Pour arrêter la connexion vous pouvez utiliser l'utilitaire
<code>pppoe-stop</code>, toujours en ligne de commande.
</p>

<a name="list"></a>
<h3><font color="#6c0023">Liste des interfaces et des routes</font></h3>
<p>
Vous pouvez lister les interfaces réseau disponibles avec la commande
<code>ifconfig</code> suivie de l'option <code>-a</code>, ou afficher
l'aide avec l'option <code>--help</code> :
</p>
<pre>
 # ifconfig -a
 # ifconfig --help
</pre>
<p>
Pour afficher la table de routage IP du noyau vous pouvez utiliser la commande
<code>route</code> sans arguments :
</p>
<pre>
 $ route
</pre>

<a name="firewall"></a>
<h3><font color="#6c0023">Gestion du pare-feu (<em>firewall</em>)</font></h3>
<p>
SliTaz fourni un pare-feu très basic, les régles de sécurité du noyau sont
lancées et les règles d'iptables sont désactivées par défaut. Vous pouvez
activer/désactiver son éxécution au démarrage, et créer de nouvelles régles
via le fichier de configuration : /etc/firewall.conf
</p>
<p>
Le script du <em>firewall</em> fournit par défaut sur SliTaz, commence par
configurer les options propre au noyau: les redirections ICMP, les sources de
routage, log des adresses impossibles et les filtres contre le spoofing. Le
script lance ensuite les règles d'Iptables définies dans la fonction
<code>iptables_rules()</code> du fichier de configuration : /etc/firewall.conf
</p>
<p>
Le <em>firewall</em> utilise l'application Iptables, il se compose de deux
fichiers : Le fichier de configuration /etc/firewall.conf et le script
/etc/init.d/firewall, que vous ne devriez pas avoir besoin de modifier. A
noter qu'il y de nombreuses options avec Iptables, pour de plus amples
informations, référez-vous à la documentation officielle de Netfilter/iptables
disponible en ligne sur :
<a href="http://www.netfilter.org/documentation/">www.netfilter.org/documentation/</a>
</p>
<h4>Démarrer, arrêter, redémarrer le firewall</h4>
<p>
Le script /etc/init.d/firewall vous permet de démarrer/redémarrer, d'arrêter
et d'afficher le status du firewall. L'option redémarrer est souvent utilisée
pour tester de nouvelles règles, après modification du fichier de
configuration. Exemple :
</p>
<pre>
 # /etc/init.d/firewall restart
</pre>
<h4>Activer/désactiver le firewall au boot</h4>
<p>
Pour activer/désactiver les options de sécurité propre au noyau, mettez "yes"
ou "no" à la variable KERNEL_SECURITY= :
</p>
<pre class="script">

# Enable/disable kernel security at boot time.
KERNEL_SECURITY="yes"

</pre>
<p>
Et pour activer/désactiver les règles d'iptables, il faut modifier la variable
IPTABLES_RULES= :
</p>
<pre class="script">

# Enable/disable iptables rules.
IPTABLES_RULES="yes"

</pre>
<h4>Ajouter, supprimer, ou modifier les règles d'iptables</h4>
<p>
fichier de configuration: /etc/firewall.conf. En bas du fichier vous trouverez
fichier de configuration: /etc/firewall.conf. En bas du fichier vous touverez
une fonction : <code>iptables_rules()</code> contenant toutes les commandes
d'iptables à lancer lors du démarrage du firewall. Pour supprimer une règle,
nous vous conseillons de commenter les lignes correspondantes avec :
<code>#</code>. A noter qu'il ne  faut pas laisser cette fonction vide, si
vous voulez désactiver les règles d'iptables, il est préférable de mettre
"no" à la variable IPTABLES_RULES= du fichier de configuration.
</p>
<p>
Exemple de règles iptables. On refuse toutes les connexions entrantes, et
sortantes, puis on accepte les connexions sur l'hôte local, le réseau local,
les ports 80 et 22 utilisés respectivement par le serveur web HTTP et le
serveur sécurisé SSH, et le port 21 pour le FTP. C'est donc très restrictif
comme règles:
</p>
<pre class="script">

# Netfilter/iptables rules.
# This shell function is include by /etc/init.d/firewall.sh
# to start iptables rules.
#
iptables_rules()
{

# Drop all connexions.
iptables -P INPUT DROP
iptables -P OUTPUT DROP

# Accept all on localhost (127.0.0.1).
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT

# Accept all on the local network (192.168.0.0/24).
iptables -A INPUT -s 192.168.0.0/24 -j ACCEPT
iptables -A OUTPUT -d 192.168.0.0/24 -j ACCEPT

# Accept port 80 for the HTTP server.
iptables -A INPUT -i $INTERFACE -p tcp --sport 80 -j ACCEPT
iptables -A OUTPUT -o $INTERFACE -p tcp --dport 80 -j ACCEPT

# Accept port 22 for SSH.
iptables -A INPUT -i $INTERFACE -p tcp --dport 22 -j ACCEPT
iptables -A OUTPUT -o $INTERFACE -tcp --sport 22 -j ACCEPT

# Accept port 21 for active FTP connections.
iptables -A INPUT -i $INTERFACE -p tcp --dport 21 -j ACCEPT
iptables -A OUTPUT -i $INTERFACE -p tcp --sport 21 -j ACCEPT

}

</pre>

<!-- End of content -->
</div>

<!-- Footer. -->
<div id="footer">
	<div class="footer-right"></div>
	<a href="#top">Haut de la page</a> | 
	<a href="index.html">Table des matières</a>
</div>

<div id="copy">
    Copyright © 2007 <a href="http://www.slitaz.org/">SliTaz</a> -
    <a href="http://www.gnu.org/licenses/gpl.html">GNU General Public License</a>;<br />
    Documentation publiées sous
    <a href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License</a>
    et codée en <a href="http://validator.w3.org/">xHTML 1.0 valide</a>.
</div>

</body>
</html>
