<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr">
<head>
    <title>SliTaz Handbook - Serveur web LightTPD</title>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1" />
    <meta name="description" content="serveur wenhttpd LightTPD host hosting configuration perl python CGI auth" />
    <meta name="expires" content="never" />
    <meta name="modified" content="2007-12-03 12:30:00" />
    <meta name="publisher" content="www.slitaz.org" />
    <meta name="author" content="Christophe Lincoln"/>
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" type="text/css" href="book.css" />
</head>
<body bgcolor="#ffffff">

<!-- Header and quick navigation -->
<div id="header">
<div align="right" id="quicknav">
    <a name="top"></a>
    <a href="packages.html">Gestion des paquets</a> |
    <a href="index.html">Table des matières</a>
</div>
<h1><font color="#3E1220">SliTaz Handbook</font></h1>
</div>

<!-- Content. -->
<div id="content">
<div class="content-right"></div>

<h2><font color="#DF8F06">Serveur web LightTPD</font></h2>

<ul>
	<li><a href="#about">A propos de LightTPD.</a></li>
	<li><a href="#var-www">/var/www</a> - Racine des documents du serveur.</li>
	<li><a href="#Public">~/Public</a> - Répertoire public des utilisateurs.</li>
	<li><a href="#config">lighttpd.conf</a> - Fichier de configuration de
	LightTPD.</li>
	<li><a href="#start-stop-restart">Démarrer, arrêter, redémarrer le
	serveur web.</a></li>
	<li><a href="http://localhost/">http://localhost/</a></li>
	<li><a href="http://localhost/server-status">http://localhost/server-status</a></li>
	<li><a href="#cgi-perl">Scripts CGI et Perl</a> - Configurer le serveur pour
	le support des scripts CGI utilisant Perl.</li>
	<li><a href="#cgi-python">Scripts CGI et Python</a> - Scripts CGI utilisant
	Python.</li>
	<li><a href="#auth">Authentification</a> - Protéger un ou des répertoires
	avec nom d'utilisateur et mots de passes.</li>
</ul>

<a name="about"></a>
<h3><font color="#6c0023">A propos de LightTPD</font></h3>
<p>
Ce chapitre décrit l'utilisation et la configuration du serveur web LightTPD.
C'est un serveur HTTP sécurisé, rapide, flexible, et utilisant une petite
empreinte mémoire. Il permet une gestion intelligente de la charge CPU, et
support FastCGI, CGI, Auth, Output-Compression, réécriture d'URL, etc.
LightTPD est un serveur idéal pour héberger son propre site, sur une ancienne
machine, et donc à moindre frais.
</p>
<p>
Sur SliTaz le serveur web est automatiquement lancé au boot du système et il
est préconfiguré avec PHP. La racine des documents servis par défaut par le
serveur sont dans /var/www et contient une page <code>index.html</code>,
s'affichant par défaut, avec des images dans le répertoire images/. Site web
de LightTPD : <a href="http://www.lighttpd.net/">http://www.lighttpd.net/</a>
</p>
<a name="var-www"></a>
<h3><font color="#6c0023">/var/www - Racine des documents du serveur</font></h3>
<p>
Le répertoire /var/www est le répertoire racine des documents servis par
défaut. Vous y avez accès via l'url <a href="http://localhost/"
>http://localhost/</a>. Ce répertoire contient un page index.html s'affichant
automatiquement lors d'une requête. Si vous ne voulez héberger qu'un site,
vous pouvez mettre tous les document dans /var/www, et si vous voulez héberger
plusieurs sites, il faut créer des hôtes virtuels.
</p>
<a name="Public"></a>
<h3><font color="#6c0023">~/Public - Répertoire public des utilisateurs</font></h3>
<p>
SliTaz propose aux utilisateurs du système d'avoir un espace public pour y
mettre des documents, HTML en général. Ce répertoire se nomme Public et doit
se trouver à la racine de votre répertoire maison, tel que :
/home/hacker/Public. Pour créer ce répertoire vous pouvez utliser la commande :
</p>
<pre>
 $ mkdir ~/Public
</pre>
<p>
Vous pouvez ensuite y avoir accès via l'url http://localhost/~user/. Exemple
pour l'utilisateur hacker :
<a href="http://localhost/~hacker/">http://localhost/~hacker/</a>. Vous pouvez
aussi utiliser le nom de machine ou l'adresse IP, pour vous y connecter depuis
une autre machine.
</p>
<a name="config"></a>
<h3><font color="#6c0023">/etc/lighttpd/lighttpd.conf - Fichier de configuration de LightTPD</font></h3>
<p>
Le fichier de configuration principal de LightTPD  se trouve dans
/etc/lighttpd, et se nomme lighttpd.conf. Le fichier de configuration fourni
par SliTaz est auto documenté, il suffit de le parcourir. Vous trouverez
d'autres exemples sur le site web de LightTPD. Sur SliTaz vous touverez aussi
un fichier <code>vhosts.conf</code> destiné à la configuration d'éventuels
hôtes virtuels (pour hébérger plusieurs sites sur le même serveur).
</p>
<a name="start-stop-restart"></a>
<h3><font color="#6c0023">Démarrer, arrêter, redémarrer le serveur web</font></h3>
<p>
Par défaut SliTaz démarre le serveur au boot, pour qu'il ne soit pas lancé
automatiquement vous devez supprimer <code>lighttpd</code> de la variable
RUN_DAEMONS qui elle, se trouve dans le fichier de configuration du système
d'initialisation <code>/etc/rcS.conf</code>. Pour démarrer, arrêter,
redémarrer le serveur web vous pouvez utiliser la commande
<code>/etc/init.d/lighttpd [start|stop|restart]</code>. Exemple pour
redémarrer le serveur après modification du fichier de configuration :
</p>
<pre>
 # /etc/init.d/lighttpd restart
</pre>

<a name="cgi-perl"></a>
<h3><font color="#6c0023">Scripts CGI et Perl</font></h3>
<p>
Pour configurer le serveur LightTPD afin qu'il trouve le chemin du binaire
<code>perl</code> et l'utiliser avec les scripts CGI/Perl, vous devez modifier
le fichier de configuration du serveur. Exemple en utilisant Geany :
</p>
<pre>
 # geany /etc/lighttpd/lighttpd.conf &amp;
</pre>
<pre class="script">
# CGI module. You can install Perl and assign .pl and .cgi script
# to /usr/bin/perl
$HTTP["url"] =~ "/cgi-bin/" {
  cgi.assign = (
    ".sh" => "/bin/sh",
    ".cgi" => "/usr/bin/perl,
    ".pl" => "/usr/bin/perl
  )
}
</pre>

<a name="cgi-python"></a>
<h3><font color="#6c0023">Scripts CGI et Python</font></h3>
<p>
Pour configurer le serveur LightTPD afin qu'il trouve le chemin du binaire
<code>python</code> et l'utiliser avec les scripts CGI/Python, vous devez
avoir installé le paquet Python et modifier le fichier de configuration du
serveur. Pour installer Python et éditer le fichiers de configuration du
serveur web en utilisant Geany :
</p>
<pre>
 # tazpkg get-install python
 # geany /etc/lighttpd/lighttpd.conf &amp;
</pre>
<pre class="script">
# CGI module. You can install Perl and assign .pl and .cgi script
# to /usr/bin/perl
$HTTP["url"] =~ "/cgi-bin/" {
  cgi.assign = (
    ".sh" => "/bin/sh",
    ".cgi" => "/usr/bin/python,
    ".py" => "/usr/bin/python
  )
}
</pre>
<p>
Pour que les modifications soient prisent en compte, et utiliser vos premier
scripts CGI/Python sur SliTaz, vous devez encore redémarrer LightTPD :
</p>
<pre>
 # /etc/init.d/lighttpd restart
</pre>

<a name="auth"></a>
<h3><font color="#6c0023">Authentification - Protéger des répertoires</font></h3>
<p>
LightTPD fournit un module d'authentification permettant par exemple, de 
protéger un répertoire. Le serveur propose plusieurs méthodes d'authentification,
pour commencer nous allons utiliser la méthode basique sans cryptage des mots
de passes. Afin de pouvoir charger le module <code>mod_auth</code>, vous devez
avoir installer le paquets lighttpd-modules (<code>tazpkg get-install 
lighttpd-modules</code>), une fois le paquet installé il faut ajouter 
<code>mod_auth</code> à la liste des modules :
</p>
<pre class="script">
# Modules to load.
# See /usr/lib/lighttpd for all available modules.
#
server.modules = (
  "mod_access",
  "mod_auth",
  "...",
)
</pre>
<p>
Maintenant vous pouvez configurer le modules en spécifiant le niveau de debug
la méthode (<code>plain</code>) et le chemin vers le fichier qui contiendra la
liste des noms:pass autorisés à voir le ou les répertoires protégés. Il faut 
aussi définir le ou les répertoires qui demandent authentification. Dans cet
exemple nous protégeons le répertoire <code>admin/</code> et autorisons son 
accès à l'utililisateur hacker (<code>user=hacker</code>) :
</p>
<pre class="script">
# Authentification for protected directory.
auth.debug = 2
auth.backend = "plain"
auth.backend.plain.userfile = "/etc/lighttpd/plain.passwd"
auth.require = ( "/admin/" =>
(
"method" => "basic",
"realm" => "Password protected area",
"require" => "user=hacker"
)
)
</pre>
<p>
Pour finir il suffit de créer le fichier des mots de passes, d'ajouter un
utilisateur et de redémarrer le serveur pour tester. La syntaxe pour les fichiers
basiques est <code>nom:pass</code>. Vous pouvez créer et ajouter un utilisateur
à ce fichier avec la commande <code>echo</code> ou l'éditer avec votre éditeur
de texte préféré. Pour un utilisateur:motdepasse <code>hacker:root</code> dans
un fichier de mots de passes <code>/etc/lighttpd/plain.passwd</code> :
</p>
<pre>
 # echo "hacker:root" > /etc/lighttpd/plain.passwd
 Ou/et :
 # nano /etc/lighttpd/plain.passwd
</pre>
<p>
Pour redémarrer le serveur et ensuite tester avec une adresse du type 
http://localhost/admin/ :
</p>
<pre>
 # /etc/init.d/lighttpd restart
</pre>

<!-- End of content -->
</div>

<!-- Footer. -->
<div id="footer">
	<div class="footer-right"></div>
	<a href="#top">Haut de la page</a> | 
	<a href="index.html">Table des matières</a>
</div>

<div id="copy">
    Copyright © 2007 <a href="http://www.slitaz.org/">SliTaz</a> -
    <a href="http://www.gnu.org/licenses/gpl.html">GNU General Public License</a>;<br />
    Documentation publiées sous
    <a href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License</a>
    et codée en <a href="http://validator.w3.org/">xHTML 1.0 valide</a>.
</div>

</body>
</html>
