<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="pt" lang="pt">
<head>
    <title>Livro de Receitas do SliTaz - Scripts de Inicialização</title>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1" />
    <meta name="description" content="slitaz portuguese cookbook" />
    <meta name="expires" content="never" />
    <meta name="modified" content="2008-02-26 18:30:00" />
    <meta name="publisher" content="www.slitaz.org" />
    <meta name="author" content="Christophe Lincoln"/>
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" type="text/css" href="book.css" />
</head>
<body bgcolor="#ffffff">

<!-- Header and quick navigation -->
<div id="header">
<div align="right" id="quicknav">
    <a name="top"></a>
    <a href="slitaz-tools.html">Ferramentas SliTaz</a> |
    <a href="index.html">Conteúdo</a>
</div>
<h1><font color="#3E1220">SliTaz Cookbook (pt)</font></h1>
</div>

<!-- Content. -->
<div id="content">
<div class="content-right"></div>

<h2><font color="#df8f06">Scripts de Inicialização</font></h2>
<p>
Os scripts de inicialização e finalização com seus arquivos de configuração.
</p>

<ul>
    <li><a href="index.html#intro">SliTaz e a Inicialização</a></li>
    <li><a href="index.html#init.d">/etc/init.d/*</a> - Diretório de Scripts e Daemons</li>
    <li><a href="index.html#rcS">/etc/init.d/rcS</a> - Scripts de Inicialização Primários</li>
    <li><a href="index.html#rc-scripts">Scripts e Daemons Específicos</a> - Scripts e
     daemons com tarefas específicas</li>
    <li><a href="index.html#inittab">/etc/inittab</a> - Arquivo de configuração init</li>
</ul>

<a name="intro"></a>
<h3><font color="#6c0023">SliTaz e a Inicialização</font></h3>

<p>
O SliTaz não usa um nível de execução (runlevel) - o sistema é inicializado
por meio de um script primário e seu arquivo de configuração principal. O script
por si só executa outros scripts menores que lidam, por exemplo, com a
internacionalização ou os comandos necessários ao início do sistema.
</p>

<a name="init.d"></a>
<h3><font color="#6c0023">/etc/init.d/* - Diretório de Scripts e Daemons</font></h3>
<p>
O diretório /etc/init.d contem todos os scripts rc, que são simples scripts shell
com a extensão ".sh", e daemons como o "dropbear" ou o "lighttpd", que são 
scripts que executam um serviço. Os scripts de daemons podem iniciar, parar ou
reiniciar por meio do comando: 
</p>
<pre> # /etc/init.d/daemon [start|stop|restart]
</pre>
<p>
No SliTaz você encontra o arquivo /etc/init.d/README que descreve as funções
básicas dos scripts rc. Note que todos os scripts de inicialização e daemons
podem executar o arquivo <code>/etc/init.d/rc.functions</code>. Este arquivo 
possibilita incluir várias funções nos scripts rc. O SliTaz usa a função
<code>status</code> para checar se o comando anterior foi executado com sucesso
(0) ou não.
</p>

<a name="rcS"></a>
<h3><font color="#6c0023">/etc/init.d/rcS - Scripts de Inicialização Primários</font></h3>
<p>
O script <code>/etc/init.d/rcS</code> configura todos os serviços básicos e 
inicializa o sistema. Ele começa montando o sistema de arquivos e iniciando
serviços como o syslogd, klogd, mdev, limpa o sistema e etc. Utiliza o arquivo
de configuração <code>/etc/rcS.conf</code> para verificar quais daemons e 
scripts executar na inicialização. Você pode ler o arquivo para saber quais
comandos são executados:
</p>
<pre> # nano rootfs/etc/init.d/rcS 
</pre>

<a name="rc-scripts"></a>
<h3><font color="#6c0023">Scripts e Daemons Específicos</font></h3>

<h4>bootopts.sh - Opções do modo LiveCD</h4>
<p>
Este script é usado para configurar as opções de LiveCD passadas no momento da
inicialização e pode ser lido por meio do arquivo /proc/cmdline. Este é o script
que permite a utilização de um Pendrive ou de um disco rígido externo - montados
na partição <code>/home</code> com a opção home=usb ou home=sda[1-9] - ou a 
especificação da linguagem e parâmetros de teclado.
</p>

<h4>network.sh - Inicialização de Rede</h4>
<p>
Este script procura pelo arquivo de configuração /etc/network.conf para sua 
utilização pela interface de rede: pode-se desejar executar o cliente DHCP 
(ou não) ou usar um IP estático. No SliTaz o script /etc/init.d/network.sh
configura as interfaces de rede para iniciarem usando as informações contidas
em /etc/network.conf. Se a variável $DHCP é igual a "yes", então o script
/etc/init.d/network.sh executa o cliente DHCP na interface $INTERFACE.
</p>

<h4>i18n.sh - Internacionalização</h4>
<p>
O SliTaz armazena a configuração do locale padrão em /etc/locale.conf que é
lido pelo arquivo /etc/profile a cada login. O /etc/locale.conf é gerado durante
a inicialização do sistema graças ao script /etc/i18n.sh. Este script executa
o aplicativo "tazlocale" se o arquivo /etc/locale.conf não existir. O mesmo
processo é utilizado para o layout de teclado usando o aplicativo "tazkmap" e
o arquivo de configuração /etc/kmap.conf. Ambos os aplicativos são instalados
e localizados em /sbin e usam dialog e a biblioteca ncurses. O script também
checa se o arquivo /etc/TZ (Time Zone) existe: se este não existe ele cria um 
baseado nas configurações de teclado.
</p>

<h4>local.sh - Comandos locais</h4>
<p>
O script /etc/init.d/local.sh permite ao administrador do sistema adicionar
comandos locais a serem utilizados no momento da inicialização. Exemplo:
</p>
<pre class="script">#!/bin/sh
# /etc/init.d/local.sh: Comandos de inicialização locais.
# Todos os comandos aqui devem ser executados no momento da inicialização.
#
. /etc/init.d/rc.functions

echo "Starting local startup commands... "

</pre>

<h4>rc.shutdown</h4>
<p>
Este script é invocado pelo /etc/inittab durante a finalização do sistema. Também
para todos os daemons especificados pela variável $RUN_DAEMONS no arquivo de 
configuração primário <code>/etc/rcS.conf</code> 
</p>

<a name="inittab"></a>
<h3><font color="#6c0023">/etc/inittab - Arquivo de Configuração init</font></h3>
<p>
O primeiro arquivo lido pelo Kernel no momento da inicialização. Define o script
de inicialização (/etc/init.d/rcS), shells (ttys) e ações no caso de uma
re-inicialização ou interferência. Pode-se encontrar um exemplo completo 
acompanhado de notas em <a href="slitaz-tools.html">Ferramentas SliTaz</a>:
</p>
<pre class="script"># /etc/inittab: init configuration for SliTaz GNU/Linux.
# Boot-time system configuration/initialization script.
#
::sysinit:/etc/init.d/rcS

# /sbin/getty respawn shell invocations for selected ttys.
tty1::respawn:/sbin/getty 38400 tty1
tty2::respawn:/sbin/getty 38400 tty2
tty3::respawn:/sbin/getty 38400 tty3
tty4::respawn:/sbin/getty 38400 tty4
tty5::respawn:/sbin/getty 38400 tty5
tty6::respawn:/sbin/getty 38400 tty6

# Stuff to do when restarting the init 
# process, or before rebooting.
::restart:/etc/init.d/rc.shutdown
::restart:/sbin/init
::ctrlaltdel:/sbin/reboot
::shutdown:/etc/init.d/rc.shutdown

</pre>

<!-- End of content -->
</div>

<!-- Footer. -->
<div id="footer">
    <div class="footer-right"></div>
    <a href="index.html#top">Topo da Página</a> | 
    <a href="index.html">Conteúdo</a>
</div>

<div id="copy">
    Copyright &copy; 2008 <a href="http://www.slitaz.org/pt/">SliTaz</a> -
    <a href="http://www.gnu.org/licenses/gpl.html">GNU General Public License</a>;<br />
    Documentation is under
    <a href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License</a>
    and code is <a href="http://validator.w3.org/">valid xHTML 1.0</a>.
</div>

</body>
</html>

