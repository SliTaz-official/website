<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="pt" lang="pt">
<head>
    <title>Manual SliTaz (pt) - Ambiente Chroot</title>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1" />
    <meta name="description" content="slitaz Portuguese handbook" />
    <meta name="expires" content="never" />
    <meta name="modified" content="2008-07-26 21:45:00" />
    <meta name="publisher" content="www.slitaz.org" />
    <meta name="author" content="Christophe Lincoln" />
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" type="text/css" href="book.css" />
</head>
<body bgcolor="#ffffff">

<!-- Header and quick navigation -->
<div id="header">
<div id="quicknav" align="right">
    <a name="top"></a>
    <a href="secure-server.html">SHell Securo (SSH)</a> |
    <a href="index.html">Conteúdos</a>
</div>
<h1><font color="#3e1220">Manual SliTaz (en)</font></h1>
</div>

<!-- Content. -->
<div id="content">
<div class="content-right"></div>

<h2><font color="#df8f06">Ambiente Chroot</font></h2>

<p>
Este documento descreve os passos necessários para criar um ambiente chroot, 
para mudar a raiz do sistema de forma que você possa trabalhar. Isto torna 
possível compilar, testar e desenvolver SliTaz sem qualquer risco para o sistema 
anfitrião no qual você está trabalhando. O sistema anfitrião pode ser o próprio 
SliTaz instalado em um disco rígido ou qualquer outro sistema GNU/Linux como 
Debian, Fedora, PCLinuxOS e assim por diante. Você também pode criar um ambiente
chroot em modo LiveCD associado a uma mídia USB. A única condição prévia é 
ter uma imagem ISO do SliTaz disponível e um pouco de tempo. Note que todos os 
comandos são levados executados como administrador de sistema (<em>root</em>).   
</p>
<h3>Preparando o ambiente</h3>
<p>
Para começar, nós temos que extrair os conteúdos da imagem ISO no diretório que 
servirá como nosso chroot. O diretório pode ser criado em qualquer lugar que 
você escolher, nós usaremos o diretório <code>/home/slitaz/chroot-env</code>. 
Para extrair os conteúdos de uma imagem ISO, nós temos que montá-la em <em>loop</em> 
em um diretório e então temos que copiar o sistema de arquivos raiz comprimido 
(<code>rootfs.gz</code>) no diretório chroot. Assumindo que a ISO está no 
diretório atual:   
</p>
<pre> # mkdir /tmp/loop
 # mount -o loop slitaz-cooking.iso /tmp/loop
 # mkdir -p /home/slitaz/chroot-env
 # cp /tmp/loop/boot/rootfs.gz \
   /home/slitaz/chroot-env
 # umount /tmp/loop
</pre>
<p>
Agora que nós temos uma cópia do sistema de arquivos comprimido, precisamos 
extrai-lo e descomprimi-lo (este é um arquivo <code>cpio</code> comprimido com 
gzip ou lzma). Para completar esta fase, nós podemos remover o <code>rootfs</code> 
que já não é necessário:   
</p>
<pre> # cd /home/slitaz/chroot-env
 # (zcat rootfs.gz 2&gt;/dev/null || lzma d rootfs.gz -so) | cpio -id
 # rm rootfs rootfs.gz
</pre>
<p>
Se descomprimir o arquivo rootfs comprimido com lzma falhar você pode usar o 
método seguinte:   
</p>
<pre> # unlzma rootfs.gz -S .gz 
 # cat rootfs | cpio -id
</pre>

<h3>Usando o ambiente</h3>
<p>
Para começar a usar o ambiente chroot, você só precisa montar alguns sistemas 
de arquivos virtuais e usar o comando <code>chroot</code>. Para simplificar as 
coisas, podemos escrever um script pequeno que automatiza o processo. Exemplo 
usando o diretório chroot <code>/home/slitaz/chroot-env</code> e criando o 
script <code>chroot_in_env.sh</code> em <code>/home/slitaz</code>. Em qualquer 
sistema que não seja o SliTaz você pode descomentar as linhas que se referem
aos diretórios <code>/dev</code> e <code>/tmp</code> - <em>Note</em> que você 
pode copiar e colar o texto seguinte:   
</p>
<pre> # cat &gt; /home/slitaz/chroot_in_env.sh &lt;&lt; "EOF"
</pre>
<pre class="script">#!/bin/sh
# Chroot in SliTaz to hack.
#
ROOTFS="/home/slitaz/chroot-env"

# Mount virtual Kernel file systems and chroot.
#
#mount --bind /dev $ROOTFS/dev
#mount --bind /tmp $ROOTFS/tmp
mount -t proc proc $ROOTFS/proc
mount -t sysfs sysfs $ROOTFS/sys
mount -t devpts devpts $ROOTFS/dev/pts
mount -t tmpfs shm $ROOTFS/dev/shm

echo "Chrooting into $ROOTFS... "
chroot $ROOTFS /bin/sh --login

# Unmount virtual Kernel file systems on exit.
#
umount $ROOTFS/dev/shm
umount $ROOTFS/dev/pts
umount $ROOTFS/sys
umount $ROOTFS/proc
#umount $ROOTFS/tmp
#umount $ROOTFS/dev

echo "Exiting $ROOTFS chroot environment... "

EOF
</pre>
<p>
Para terminar e testar o ambiente, você só precisa tornar o script executável 
e executá-lo:
</p>
<pre> # chmod +x /home/slitaz/chroot_in_env.sh
 # sh /home/slitaz/chroot_in_env.sh
</pre>
<h4>Ativar a internet </h4>
<p>
Para ter a internet pronta para baixar e instalar alguns pacotes de 
desenvolvimento, apenas inicie o cliente DHCP na interface correta. Exemplo 
usando <code>eth1</code>:   
</p>
<pre> /# udhcpc -i eth1
</pre>
<h4>Instalando pacotes</h4>
<p>
Se a internet estiver funcionando, apenas recarregue a lista de pacotes e use o 
comando <code>tazpkg get-install</code> para instalar. Se uma conexão não for 
possível, você pode baixar os pacotes de outro sistema, copiando-os para o 
ambiente chrooted e instalando-os com o comando <code>tazpkg install</code>. 
Para instalar as ferramentas básicas de compilação:   
</p>
<pre> /# tazpkg recharge
 /# tazpkg get-install slitaz-toolchain
</pre>
<p>
Estando o ambiente configurado, você pode compilar aplicações a partir 
do código-fonte para criar pacotes, scripts de teste etc. 
O <a href="../cookbook/">Cookbook</a> (Livro de receitas) deve ajudá-lo nesta 
parte:   
</p>
<h4>Encerrando o ambiente </h4>
<p>
Para encerrar o ambiente chroot, apenas digite <code>exit</code>, o script 
<code>chroot_in_env.sh</code> terminará, desmontando os sistemas de arquivos 
virtuais do Kernel Linux:   
</p>
<pre> /# exit
 #
</pre>

<!-- End of content -->
</div>

<!-- Footer. -->
<div id="footer">
	<div class="footer-right"></div>
	<a href="#top">Topo da Página</a> | 
	<a href="index.html">Conteúdo</a>
</div>

<div id="copy">
    Copyright © 2008 <a href="http://www.slitaz.org/pt/">SliTaz</a> -
    <a href="http://www.gnu.org/licenses/gpl.html">GNU General Public License</a>;<br />
    Documentation is under
    <a href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License</a>
    and code is <a href="http://validator.w3.org/">valid xHTML 1.0</a>.
</div>

</body>
</html>

