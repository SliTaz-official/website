<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>SliTaz Handbook - Network configuration</title>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1" />
    <meta name="description" content="slitaz English handbook network config pppoe ppp eth dhcp" />
    <meta name="expires" content="never" />
    <meta name="modified" content="2008-02-26 18:30:00" />
    <meta name="publisher" content="www.slitaz.org" />
    <meta name="author" content="Paul Issot, Christophe Lincoln"/>
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" type="text/css" href="book.css" />
</head>
<body bgcolor="#ffffff">

<!-- Header and quick navigation -->
<div id="header">
<div align="right" id="quicknav">
    <a name="top"></a>
    <a href="http://www.slitaz.org/en/">www.slitaz.org/en</a> |
    <a href="index.html">Table of contents</a>
</div>
<h1><font color="#3E1220">SliTaz Handbook (en)</font></h1>
</div>

<!-- Content. -->
<div id="content">
<div class="content-right"></div>

<h2><font color="#DF8F06">Network configuration</font></h2>

<ul>
	<li><a href="#eth">Ethernet connection</a> - DHCP or static IP.</li>
	<li><a href="#driver">Install network card driver</a> - Find and load Kernel
	modules.</li>
	<li><a href="#pppoe">PPPoE kernel-mode</a> - Dial-up modem connection in 
	Kernel mode.</li>
	<li><a href="#rp-pppoe">PPPoE with rp-pppoe</a> - Dial-up modem.</li>
        <li><a href="#firewall">Firewall</a> - Manage the Firewall (Iptables).</li>
</ul>

<a name="eth"></a>
<h3>Ethernet connection</h3>
<p>
By default SliTaz starts a DHCP client (udhcpc) on eth0 at boot time. If your
network card has been identified as an <code>eth0</code> interface and you use
a router, your connection should already be working. DHCP is dynamically
configured, on each boot the client asks for a new IP address from 
the DHCP server, which is integrated into the router, or on another computer.
If you need a static IP, you can directly edit config files or use the GUI
<code>netbox</code> available from JWM menu --&gt; System tools. In a terminal
or a Linux console, you can list all available network interfaces with the 
command <code>ifconfig</code> followed by the <code>-a</code> option:
</p>
<pre>
 $ ifconfig -a
</pre>
<p>To display the Kernel's IP routing table, you can use the <code>route</code> command
without any arguments:
</p>
<pre>
$ route
</pre>
<p>
The system wide network configuration file is <code>/etc/network.conf</code>,
it can be graphically configured with <code>netbox</code> or directly edited by
the root administrator.
</p>

<a name="driver"></a>
<h3>Install network card driver</h3>
<p>
In case you need a network card driver and dont know the driver name, you can
use the command <code>lspci</code> to find your card and then <code>modprobe</code>
to load a module. In Live mode you can use the SliTaz boot option 
<code>modprobe=modules</code> to automatically load Kernel modules. To get a 
list of all available network card drivers, display PCI eth cards and load a
module:
</p>
<pre>
 # modprobe -l | grep drivers/net
 # lspci | grep [Ee]th
 # modprobe -v module_name
</pre>
<p>
On an installed system you just need to add the module_name to the variable 
<code>LOAD_MODULES </code> in <code>/etc/rcS.conf</code> to load your module 
on each boot.
</p>

<a name="pppoe"></a>
<h3><font color="#6c0023">PPPoE connection kernel-mode</font></h3>
<p>
PPPoE connection in kernel-mode needs 2 files. The first file is
<code>/etc/ppp/options</code> where you must specify your login name:
</p>
<pre class="script">
plugin rp-pppoe.so
name &lt;your provider connection ID&gt;
noipdefault
defaultroute
mtu 1492
mru 1492
lock
</pre>
<p>
Now you have to configure /etc/ppp/pap-secrets or /etc/ppp/chap-secrets:
</p>
<pre class="script">
# client	       server	       secret			IP addresses
"your_login"       *               "your_password"
</pre>
<p>
The config file /etc/resolv.conf will be automatically loaded up. Finished, you can 
now connect to the internet with <code>pppd</code>:
</p>
<pre>
pppd eth0
</pre>
<p>
On an installed system you can start pppd on each boot using the local startup
script: <code>/etc/init.d/local.sh</code>
</p>

<a name="rp-pppoe"></a>
<h3><font color="#6c0023">Enable Dial-up Modem -  PPPoE with rp-pppoe</font></h3>
<p>
To set an ASDL protocol via PPPoE, SliTaz provides the following utilities 
package <code>rp-pppoe</code>. Using <code>pppoe-setup</code> is a snap and you
can quickly configure the network. If you use DCHP it's even easier, because 
the server from your ISP will take care of everything. If you do not have DHCP,
you must first disable it's use via <code>DHCP="no"</code> from the 
configuration file <code>/etc/network.conf</code>. It should be noted that to
modify configuration files and system logs you must first become <code>su</code>.
To install and change the variable DHCP with Nano (ctrl + x to save &amp; exit):
</p>
<pre>
 $ su
 # tazpkg get-install rp-pppoe
 # nano /etc/network.conf
</pre>
<h4>Configure with pppoe-setup</h4>
<p>
To begin to configure your PPPoE connection, you must first open an Xterm or 
Linux consule and launch <code>pppoe-setup</code> and then begin to answer
the following questions:
</p>
<pre>
  # pppoe-setup
</pre>
<ol>
	<li>Enter your username, please note that this is the username with which you
	    communicate with your ISP.</li>
	<li>Internet interface, default is eth0 unless you have more than one,
	    in which case you will have eth1, eth2 etc. Usually the Enter key is 
	    sufficient.</li>
	<li>If you have a permanent ASDL link answer
	    <strong>yes</strong>, or <strong>no</strong> (default).</li>
	<li>Specify primary and secondary DNS your ISP uses (you may have to ask).</li>
	<li>Enter the password with which you communicate with your ISP (you need 
	    to enter twice).</li>
	<li>Choose the firewall or firewall depending on your hardware. If you 
	    have a router you can enter 1 or 2. If in doubt enter 1.</li>
</ol>
<h4>Start and Stop the connection</h4>
<p>
Still using the command line, simply type <code>pppoe-start</code> to start 
the connection. A few seconds later the system tells you that it is connected.
If it gives you a message like TIMED OUT you may have poorly configured or 
the connection is defective. Please check the wiring and repeat the installation
from the beginning. To start the connection:
</p>
<pre> # pppoe-start
</pre>
<p>
To stop the connection, you can use
<code>pppoe-stop</code>, using the command line.
</p>

<a name="firewall"></a>
<h3><font color="#6c0023">Manage the Firewall (<em>firewall</em>) using Iptables</font></h3>
<p>
SliTaz provides a very basic firewall, the kernel security rules are launched 
at boot time and iptables rules are disabled by default. You can 
activate/disable these at startup by using the configuration file: 
/etc/firewall.conf.
</p>
<p>
The default <em>firewall</em> script begins with it's own set options for the 
Kernel ie. ICMP redirects, source routing, logs for unresolved addresses and 
spoof filters. The script then launches the rules defined in the 
<code>iptables_rules()</code> function of the configuration file:
/etc/firewall.conf.
</p>
<p>
The <em>firewall</em> uses Iptables, it consists of two files, the 
/etc/firewall.conf and /etc/init.d/firewall, you shouldn't need to modify 
these. Note Iptables has lots of options, for more infomation see the official
documentation available online:
<a href="http://www.netfilter.org/documentation/">www.netfilter.org/documentation/</a>.
</p>
<h4>Start, stop, restart the firewall</h4>
<p>
The script /etc/init.d/firewall lets you start/restart, stop or display the 
status of the firewall. The restart option is often used to test new rules 
after editing the configuration file. Example:
</p>
<pre>
 # /etc/init.d/firewall restart
</pre>
<h4>Enable/Disable the firewall at boot</h4>
<p>
To enable/disable options specific to the Kernel place, "yes"
or "no" in the variable KERNEL_SECURITY= :
</p>
<pre class="script">
# Enable/disable kernel security at boot time.
KERNEL_SECURITY="yes"
</pre>
<p>
and to activate/deactivate the iptables rules, it is necessary to modify the 
variable IPTABLES_RULES= :
</p>
<pre class="script">
# Enable/disable iptables rules.
IPTABLES_RULES="yes"
</pre>
<h4>Add, delete or modify the iptables rules</h4>
<p>
At the bottom of the configuration file:  /etc/firewall.conf. you will find a 
function named: <code>iptables_rules()</code>, this contains all of the iptables
commands to launch when the firewall starts. To delete a rule, It is advisable
to comment out the corresponding line with a <code>#</code>. It is not 
advisable to leave the function completely empty, if you want to disable 
iptables rules just add "no" to the variable IPTABLES_RULES= in the 
configuration file.
</p>
<p>
Here's an example of using iptables rules, it refuses all connections incoming
and outgoing, only allowing connections on the localhost, the local network, 
ports 80 and 22 used respectively by the web server HTTP and SSH secure server
and port 21 for FTP; so it's very restrictive.
</p>
<pre class="script">
# Netfilter/iptables rules.
# This shell function is include in /etc/init.d/firewall.sh
# to start iptables rules.
#
iptables_rules()
{

# Drop all connexions.
iptables -P INPUT DROP
iptables -P OUTPUT DROP

# Accept all on localhost (127.0.0.1).
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT

# Accept all on the local network (192.168.0.0/24).
iptables -A INPUT -s 192.168.0.0/24 -j ACCEPT
iptables -A OUTPUT -d 192.168.0.0/24 -j ACCEPT

# Accept port 80 for the HTTP server.
iptables -A INPUT -i $INTERFACE -p tcp --sport 80 -j ACCEPT
iptables -A OUTPUT -o $INTERFACE -p tcp --dport 80 -j ACCEPT

# Accept port 22 for SSH.
iptables -A INPUT -i $INTERFACE -p tcp --dport 22 -j ACCEPT
iptables -A OUTPUT -o $INTERFACE -tcp --sport 22 -j ACCEPT

# Accept port 21 for active FTP connections.
iptables -A INPUT -i $INTERFACE -p tcp --dport 21 -j ACCEPT
iptables -A OUTPUT -i $INTERFACE -p tcp --sport 21 -j ACCEPT

}

</pre>

<!-- End of content -->
</div>

<!-- Footer. -->
<div id="footer">
	<div class="footer-right"></div>
	<a href="#top">Top of the page</a> | 
	<a href="index.html">Table of contents</a>
</div>

<div id="copy">
    Copyright &copy; 2008 <a href="http://www.slitaz.org/en/">SliTaz</a> -
    <a href="http://www.gnu.org/licenses/gpl.html">GNU General Public License</a>;<br />
    Documentation is under
    <a href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License</a>
    and code is <a href="http://validator.w3.org/">valid xHTML 1.0</a>.
</div>

</body>
</html>

