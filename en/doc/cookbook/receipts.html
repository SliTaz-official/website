<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>SliTaz Cookbook (en) - Receipts</title>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1" />
    <meta name="description" content="slitaz English cookbook" />
    <meta name="expires" content="never" />
    <meta name="modified" content="2008-07-16 21:45:00" />
    <meta name="publisher" content="www.slitaz.org" />
    <meta name="author" content="Christophe Lincoln"/>
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" type="text/css" href="book.css" />
</head>
<body bgcolor="#ffffff">

<!-- Header and quick navigation -->
<div id="header">
<div align="right" id="quicknav">
    <a name="top"></a>
	<a href="build-host.html">Build Host</a> |
    <a href="index.html">Table of contents</a>
</div>
<h1><font color="#3E1220">SliTaz Cookbook (en)</font></h1>
</div>

<!-- Content. -->
<div id="content">
<div class="content-right"></div>


<h2><font color="#df8f06">Receipts</font></h2>

<p>
This document describes the opportunities offered by the receipt used by 
Tazwok to compile and generate packages for SliTaz and Tazpkg through 
<a href="wok-tools.html">The wok and tools</a>. The receipt for a package is 
also used by Tazpkg to install/uninstall and provide information about a 
.tazpkg package. Each receipt begins with a comment in English:
</p>
<pre class="script">
# SliTaz package receipt.
</pre>

<h3>Variables</h3>
<p>
The first 5 variables should always be present and defined. They respectively 
configure the package ($PACKAGE), its version, its category, provide a short 
description and the name of the maintainer. Example for the package, file 
manager Clex:
</p>
<pre class="script">
PACKAGE="clex"
VERSION="3.16"
CATEGORY="base-apps"
SHORT_DESC="Text mode file manager."
MAINTAINER="pankso@slitaz.org"
</pre>

<h3>Variables (optional)</h3>
<p>
Tazwok also knows how to use various optional variables. It can, for example, 
use the name of another source package. There are also variables that are 
used by Tazpkg to manage dependencies or provide information about the package.
</p>
<p>
<a name="depends"></a>
<code>$DEPENDS</code>: Set dependencies, there may be several dependencies 
seperated by a space or on several lines. This variable is used mainly by 
Tazpkg when installing the package and Tazwok to build large packages such 
as Xorg. Example for Clex which depends on ncurses:
</p>
<pre class="script">
DEPENDS="ncurses"
</pre>
<p>
<a name="build_depends"></a>
<code>$BUILD_DEPENDS</code>: Set compilation dependencies, again seperated 
by a space or several lines. This variable is used by Tazwok during the 
cooking of a package. Example:
</p>
<pre class="script">
BUILD_DEPENDS="ncurses-dev"
</pre>
<p>
<a name="tarball"></a>
<code>$TARBALL</code> : The archive is a source with the extension (tar.gz, 
tgz or tar.bz2). In general, the variables $PACKAGE and $VERSION are used to 
just change the extension, it helps to upgrade the package without changing 
the $VERSION variable. Generic example (see also $SOURCE example):
</p>
<pre class="script">
TARBALL="$PACKAGE-$VERSION.tar.gz"
</pre>
<p>
<a name="web_site"></a>
<code>$WEB_SITE</code> : The official website of the package. It may be that 
some libraries have no website, in this case, there is no need to specify a 
URL. Note Tazwok and Tazpkg both expect to find a URL with the complete HTTP:
</p>
<pre class="script">
WEB_SITE="http://www.clex.sk/"
</pre>
<p>
<a name="wget_url"></a>
<code>$WGET_URL</code> : URL to download the source file. In general the 
variable $TARBALL should be used to facilitate the updating of the package
without changing the $VERSION. Using a configuration file, Tazwok also 
configures by default 3 mirrors: $GNU_MIRROR for the GNU mirror, $SF_MIRROR 
for SourceForge and XORG_MIRROR for mirroring the graphical server Xorg. 
Example for Clex:
</p>
<pre class="script">
WGET_URL="http://www.clex.sk/download/$TARBALL"
</pre>
<p>
<a name="config_files"></a>
<code>$CONFIG_FILES</code> : Some packages provide customized 
configuration files. The $CONFIG_FILES variable provides a list of these 
files that can be saved by the 'tazpkg repack-config' command. 
These files are not overwritten when reinstalling the package if they already
exist and the package can be successfully recreated with 'tazpkg repack', 
(even if they have been modified since). Netatalk for example:
</p>
<pre class="script"> CONFIG_FILES="/etc/netatalk/AppleVolumes.* /etc/netatalk/*.conf"
</pre>
<p>
<a name="suggested"></a>
<code>$SUGGESTED</code> : Lists useful packages without being essential. 
Also used to activate optional features.
</p>
<p>
<a name="wanted"></a>
<code>$WANTED</code> : SliTaz packages normally depend on the compilation of 
a source package. Sometimes the receipt of a package requires no compilation 
of rules, then $WANTED is used to copy files from the source of another 
package by using the variable $ src.
</p>
<p>
<a name="source"></a>
<code>$SOURCE</code> : It may be that the Tazpkg package name differs from 
the name of the source package. Example for Xorg packages, the name of Tazpkg 
library X11 is 'xorg-libX11' and the name of the package source is libX11. 
$SOURCE allows you to use the variables $src and $_pkg during the cooking of 
a package. It should be noted that in the case of libX11, the name of the 
source archive becomes $SOURCE-$VERSION.tar.gz.
</p>
<p>
<a name="provide"></a>
<code>$PROVIDE</code> : Some packages offer the same functionality, for 
instance the web server was at first lighttpd, now apache is available. 
All packages dependent on a web server refer to lighttpd. 
The <code>$PROVIDE="apache"</code> variable in the apache receipt says 
that packages dependent on lighttpd do not need to install the lighttpd 
package if apache is already on the system. Some packages may vary according 
to the webserver you choose, ie. the php package is dependent on lighttpd, 
as is php-apache on apache. The <code>PROVIDE="php:apache"</code> in the 
apache receipt says that you must install php-apache instead of php, if 
apache is already on the system. Therefore each package dependent on php 
will install either php-apache or php according to the webserver on the 
system. This variable also chooses packages compiled with different options. 
The <code>PROVIDE="epdfview:cups"</code> in the epdfview-cups receipt allows 
you to install epdfview with printer support via cups if cups is already on 
the system. 
</p>
<p>
You can also define virtual packages with this variable. 
The lines <code>PROVIDE="libgl"</code> in the mesa package and 
<code>PROVIDE="libgl:nvidia"</code> in the nvidia-glx package, define that 
libgl is an optimized version when the nvidia package is installed.
</p>

<h3>Variables automatically generated by Tazwok</h3>
<p>
Certain factors are known only during the cooking of
a package or after the package has been cooked. Tazwok
will add them to the receipt automatically.
</p>
<p>
<a name="packed_size"></a>
<code>$PACKED_SIZE</code> : Tazpkg file size.
</p>
<p>
<a name="unpacked_size"></a>
<code>$UNPACKED_SIZE</code> : Space taken up by the package after
installation.
</p>
<p>
<a name="extraversion"></a>
<code>$EXTRAVERSION</code> : Some packages have 2 different versions. 
This is in case of modules added to the Linux kernel, such as squashfs, 
because the module depends on the version of the kernel with which it was 
compiled. In this case $EXTRAVERSION contains the kernel version and Tazwok 
determines the module from the contents of /lib/modules.
</p>

<h3>Variables used in functions</h3>
<p>
Tazwok configures several variables that facilitate the compilation and 
construction of Tazpkg packages. These variables are controlled automatically
by Tazwok using the information contained in the receipt; they can be used
by the functions compile_rules and genpkg_rules described in the chapter 
Functions.
</p>
<p>
<a name="src"></a>
<code>$src</code> : Defines the path to the directory of unarchived sources.
</p>
<p>
<a name="pkg"></a>
<code>$_pkg</code> : Defines the path to the compiled binaries installed via 
'make DESTDIR=$PWD/_pkg install'. This variable is used to copy the generated 
files and create Tazpkg packages.
</p>
<p>
<a name="fs"></a>
<code>$fs</code> : Defines the path to the pseudo filesystem (fs) in each 
package. The 'fs' of the package corresponds to the root of the system, a bit
like Clex will for example be in $fs/usr/bin/clex. Note the need to create the 
necessary directories via function genpkg_rules() before copying the files.
</p>
<p>
<a name="configure_args"></a>
<code>$CONFIGURE_ARGS</code> : This variable is defined in the Tazwok 
configuration file (tazwok.conf). It allows you to specify generic optimization
arguments during construction of a package. Default is the i486 architecture.
</p>

<h3>Functions</h3>
<p>
A receipt may contain 4 functions. Tazwok knows how to deal with functions 
containing compilation rules (compile_rules) and rules used to generate a 
package (genpkg_rules). These functions may contain all sorts of GNU/Linux 
standard commands, such as sed, awk, patch and variables automatically 
configured.
</p>
<a name="compile_rules"></a>
<h4>compile_rules()</h4>
<p>
To compile a package you can use the variable $src to move (cd) in the 
directory of sources and use $CONFIGURE_ARGS to include arguments from the 
Tazwok configuration file. To build the package you usually launch 'make' 
without any arguments, and to install the package into the directory _pkg, 
it is necessary to use the command 'make DESTDIR=$PWD/_pkg install'. Generic
example:
</p>
<pre class="script">
# Rules to configure and make the package.
compile_rules()
{
	cd $src
	./configure --prefix=/usr --infodir=/usr/share/info \
	--mandir=/usr/share/man $CONFIGURE_ARGS
	make
	make DESTDIR=$PWD/_pkg install
}
</pre>
<a name="genpkg_rules"></a>
<h4>genpkg_rules()</h4>
<p>
To generate a tazkg package we must specify commands in the function 
<code>genpkg_rules</code>. In this example we create a psuedo directory 
<code>usr/</code> in the filesystem of the package, copy the whole 
binary(s) and finally use strip to clean the files:
</p>
<pre class="script">
# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	mkdir -p $fs/usr
	cp -a $_pkg/usr/bin $fs/usr
	strip -s $fs/usr/bin/*
}
</pre>
<a name="pre_install"></a>
<h4>pre_install() and post_install()</h4>
<p>
These 2 functions are initiated by Tazpkg when installing the package. They 
must be defined before generating the .tazpkg package with Tazwok. If no rules 
are given for these functions, they have no raison d'etre and can be removed.
Example using echo to display some text (no function should be empty):
</p>
<pre class="script">
# Pre and post install commands for Tazpkg.
pre_install()
{
	echo "Processing pre-install commands..."
}
post_install()
{
	echo "Processing post-install commands..."
}
</pre>
<a name="clean_wok"></a>
<h4>clean_wok()</h4>
<p>
This function helps to define additional commands to be run when cleaning the wok, 
it is useful to delete files or directories that are not supported by Tazwok.
</p>
<pre class="script"># clean commands for Tazwok.
clean_wok()
{
	rm -rf $WOK/$PACKAGE/vim71
}
</pre>

<!-- End of content -->
</div>

<!-- Footer. -->
<div id="footer">
	<div class="footer-right"></div>
	<a href="index.html#top">Top of the page</a> | 
	<a href="index.html">Table of contents</a>
</div>

<div id="copy">
    Copyright &copy; 2008 <a href="http://www.slitaz.org/en/">SliTaz</a> -
    <a href="http://www.gnu.org/licenses/gpl.html">GNU General Public License</a>;<br />
    Documentation is under
    <a href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License</a>
    and code is <a href="http://validator.w3.org/">valid xHTML 1.0</a>.
</div>

</body>
</html>
