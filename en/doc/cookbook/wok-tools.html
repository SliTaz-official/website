<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>SliTaz Cookbook (en) - Wok &amp; Tools</title>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1" />
    <meta name="description" content="slitaz English cookbook" />
    <meta name="expires" content="never" />
    <meta name="modified" content="2008-07-16 21:45:00" />
    <meta name="publisher" content="www.slitaz.org" />
    <meta name="author" content="Christophe Lincoln, Paul Issot"/>
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" type="text/css" href="book.css" />
</head>
<body bgcolor="#ffffff">

<!-- Header and quick navigation -->
<div id="header">
<div align="right" id="quicknav">
    <a name="top"></a>
    <a href="receipts.html">Receipts</a> |
    <a href="index.html">Table of contents</a>
</div>
<h1><font color="#3E1220">SliTaz Cookbook (en)</font></h1>
</div>

<!-- Content. -->
<div id="content">
<div class="content-right"></div>

<h2><font color="#DF8F06">Wok &amp; Tools</font></h2>

<ul>
	<li><a href="#tazwok">Overview.</a></li>
	<li><a href="#wok">Wok tools.</a></li>
	<li><a href="#cook">Compile and generate packages.</a></li>
	<li><a href="#opts">Options during compilation of package.</a></li>
	<li><a href="#files">Files included or excluded packages.</a></li>
	<li><a href="#categories">Categories of packages.</a></li>
	<li><a href="#woktree">Structure of packages in the wok.</a></li>
	<li><a href="#pkgtree">Structure of tazpkg package.</a></li>
	<li><a href="receipts.html">Receipts.</a></li>
</ul>

<a name="tazwok"></a>
<h3>Overview - Tazwok and the wok</h3>
<p>
The idea is to use a directory (wok) containing all the available packages, each package contains 
at least one receipt to download, unpack, compile and generate the binary package. To operate,
tazwok also needs to create a directory to store downloaded sources ($SOURCES_REPOSITORY) and a
repository of generated packages ($PACKAGES_REPOSITORY), these values can be configured using the
<code>/etc/tazwok.conf</code> file.
</p>

<a name="wok"></a>
<h3><font color="#6c0023">Wok tools</font></h3>
<p>
To begin, tazwok must already be installed
on the system and the main development tools (binutils, compiler, libraries-dev, make) must be downloaded.
On Slitaz you need to install the meta-package <code>slitaz-toolchain</code>:
</p>
<pre> # tazpkg recharge
 # tazpkg get-install slitaz-toolchain
</pre>
<p>
To access the SliTaz repositories you need to install the <code>mercurial</code> package:
</p>
<pre> # tazpkg get-install mercurial
</pre>
<h4>Get the wok</h4>
<p>
Before working it is necessary to recover the wok from the Mercurial repositories or an archive of
the primary mirror (TuxFamily). Example using SliTaz to be built in <code>/home/slitaz</code>:
</p>
<pre> $ hg clone http://hg.slitaz.org/wok/ /home/slitaz/wok
</pre>
<p>
The archives are also available from the URL: 
<a href="ftp://download.tuxfamily.org/slitaz/wok/">ftp://download.tuxfamily.org/slitaz/wok/</a>.
Just take the latest version from the cooking or undigest directories. Before compiling your first package,
tazwok must know where to look for the files. By default the path is <code>/home/slitaz/wok</code>,
you can change this or rename the wok you want to download. To view/check tazwok paths that will be used 
and the number of packages in the wok, you can use the tazwok command <code>stats</code>:
</p>
<pre> # tazwok stats
</pre>

<a name="cook"></a>
<h3>Compile and generate packages</h3>
<p>
Configure, compile, strip.., The way SliTaz generates a package can be put into a single command.
To avoid frustration, it is advisable to build your package without changing its receipt or seeking
dependancies. M4 is an ideal candidate for your first <code>cook</code>:
</p>
<pre> # tazwok cook m4
</pre>
<p>
Once the work is finished, the package is located in the directory specified by the configuration file
(default <code>/home/slitaz/packages</code>). If all went well, you can install the package on the host system
or use it to generate a LiveCD distribution via tazlito. To create a new package you can use <code>new-tree</code> 
with the option <code>--interactive</code> and read the documentation on the options provided by the
<a href="receipts.html">receipt</a>.
</p>
<h4>Cook-list - List of cooking</h4>
<p>
To compile several packages with a single command, you can use a cooking list. There are example lists in
<code>usr/share/examples/tazwok/cooklists</code> on SliTaz, these are just text files with a package put on every line.
Cook-list example using mypkgs.cooklist:
</p>
<pre> # tazwok cook-list mypkgs.cooklist
</pre>

<a name="opts"></a>
<h3>Options during compilation of package</h3>
<p>
You are free to use any options you want, it is necessary to respect the FSH, the docs in <code>/usr/share/doc</code>
and follow the Freedesktop standards (.desktop). Then it's just a question of choice, for example you can disable 
support for XML, have smaller binaries for PHP and get rid of libxml2, but in the case of PHP, it's not worth the
cost in terms of loss of functionality. If you have any doubts, look at the receipts and compiler options in
<code>compile_rules</code>.
</p>
<h4>Optimization</h4>
<p>
The official SliTaz packages are optimized for i486, the optimization arguments used to configure are specified in
<code>/etc/tazwok.conf</code> and can be called via the variable <code>$CONFIGURE_ARGS</code>. 
If you want to compile a package with different arguments, you can modify the tazwok configuration file:
</p>
<pre class="script">CONFIGURE_ARGS="--build=i486-pc-linux-gnu --host=i486-pc-linux-gnu"
</pre>

<a name="files"></a>
<h3>Files included or excluded packages</h3>
<p>
Generally the base packages contain no man, info, doc or static libraries, we have to create them via a package-doc
or a package-dev. Note that SliTaz is not intending to use the man or info command, so there's no manual or GNU
info file. The creation of packages containing docs is really optional, especially if the material is in English
(I say). By contrast a piece of text on the package in the Handbook is more appreciated.
</p>
<p>
In terms of configuration, whenever possible, the aim is to offer basic configuration files to run the package 
directly. In the case of the web server LightTPD package, SliTaz supplies configuration files and startup scripts
located in /etc/init.d (documented in the Handbook). For a new package, you are free to choose its default 
configuration depending on what you think is easiest for the end user. On SliTaz you have <code>/usr/share/examples</code>
for example configurations and other kinds of useful infomation.
</p>

<a name="categories"></a>
<h3>Categories of packages</h3>
<p>
The categories of packages exist only for informational purposes and are not fixed, the idea is to classify
packages so that a web page can be generated each night recovering data in the package receipt. For the short term, place
developement packages in 'devel', Xorg in 'x-window' and the variety of new packages in 'extra'
</p>

<a name="woktree"></a>
<h3>Structure of a package in the wok</h3>
<p>
The structure of the packages in the wok should always be respected so that tazwok can find the correct files and directories.
Possible contents of a package (note the directory taz/ is created at time of cooking):
</p>
<ul>
	<li><code>stuff/</code> : The material used to configure, compile and generate the package
	 (patch(es), Makefile, pseudo fs, etc).</li>
	<li><code>taz/</code> : Directory tree containing the package tazpkg generated, the compressed package is stored
	in the directory specified by $PACKAGES_REPOSITORY in the tazwok configuraton file.</li>
	<li><code>receipt</code> : The receipt (see 
	<a href="receipts.html">receipts</a>).</li>
	<li><code>description.txt</code> : (optional) The description of the package is copied to the root of the tazpkg
	package. Once installed, tazpkg knows how do deal with this file via 'tazpkg desc pkgname'.</li>
</ul>

<a name="pkgtree"></a>
<h3>Structure of a tazpkg package </h3>
<p>
The SliTaz packages are cpio archives containing files and a filesystem compressed with gzip:
</p>
<ul>
	<li><code>fs/</code> : Pseudo filesystem containing all the files to install.</li>
	<li><code>receipt</code> : The receipt (see receipt.txt).</li>
	<li><code>files.list</code> : A list of files in the package.</li>
	<li><code>description.txt</code> : The description of the package (optional).</li>
</ul>

<!-- End of content -->
</div>

<!-- Footer. -->
<div id="footer">
	<div class="footer-right"></div>
	<a href="#top">Top of the page</a> | 
	<a href="index.html">Table of contents</a>
</div>

<div id="copy">
    Copyright &copy; 2008 <a href="http://www.slitaz.org/en/">SliTaz</a> -
    <a href="http://www.gnu.org/licenses/gpl.html">GNU General Public License</a>;<br />
    Documentation is under
    <a href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License</a>
    and code is <a href="http://validator.w3.org/">valid xHTML 1.0</a>.
</div>

</body>
</html>

